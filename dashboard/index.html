<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial;
        background: #f5f5f5;
        padding: 20px;
    }

    .box {
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.15);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: left;
    }

    th {
        background: #007bff;
        color: white;
    }

    #search {
        width: 100%;
        padding: 10px;
        font-size: 15px;
        margin-bottom: 15px;
    }

    .countBox {
        background: #007bff;
        padding: 12px;
        color: white;
        border-radius: 6px;
        text-align: center;
        margin-bottom: 15px;
    }
</style>

</head>

<body>

<div class="box">
    <h2>Attendance Dashboard</h2>

    <div class="countBox">
        <h3>Total Present: <span id="count">0</span></h3>
    </div>

    <input type="text" id="search" placeholder="Search by name or ID..." onkeyup="filterTable()">

    <table id="table">
        <thead>
            <tr>
                <th>Employee ID</th>
                <th>Name</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>

<script>
// ------------------------------------------------
// FIREBASE CONFIG
// ------------------------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyB-cRwUJ8zcb1pWbToYXMtZg76vjhTMUPs",
  authDomain: "attendance-system-b1d37.firebaseapp.com",
  projectId: "attendance-system-b1d37",
  storageBucket: "attendance-system-b1d37.firebasestorage.app",
  messagingSenderId: "298377818582",
  appId: "1:298377818582:web:48222962ad7981828f3477"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ------------------------------------------------
// REALTIME DASHBOARD LISTENER
// ------------------------------------------------
const tbody = document.getElementById("tbody");
const countBox = document.getElementById("count");

db.ref("attendance").on("value", snapshot => {
    tbody.innerHTML = "";
    let count = 0;

    snapshot.forEach(child => {
        const data = child.val();
        count++;

        const row = `
            <tr>
                <td>${data.employeeID}</td>
                <td>${data.employeeName}</td>
                <td>${new Date(data.timestamp).toLocaleString()}</td>
            </tr>
        `;
        tbody.innerHTML += row;
    });

    countBox.innerText = count;
});

// ------------------------------------------------
// TABLE FILTER
// ------------------------------------------------
function filterTable() {
    const query = document.getElementById("search").value.toLowerCase();
    const rows = tbody.getElementsByTagName("tr");

    for (let row of rows) {
        const txt = row.innerText.toLowerCase();
        row.style.display = txt.includes(query) ? "" : "none";
    }
}
</script>

</body>
</html>
